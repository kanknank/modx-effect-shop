!function(t){var e={};function r(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(o,i,function(e){return t[e]}.bind(null,i));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=25)}({0:function(t,e,r){"use strict";function o(t,e,r,o,i,n,s,a){var c,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=r,l._compiled=!0),o&&(l.functional=!0),n&&(l._scopeId="data-v-"+n),s?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},l._ssrRegister=c):i&&(c=a?function(){i.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(l.functional){l._injectStyles=c;var u=l.render;l.render=function(t,e){return c.call(e),u(t,e)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,c):[c]}return{exports:t,options:l}}r.d(e,"a",(function(){return o}))},20:function(t,e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=document.querySelectorAll(".vue-shop-cart")||[],i={data:{status:"loading",cart:{qty:0,items:{}},methods:{},form:{},lastOrder:{},loading:{cart:!0,form:!1},error:"",favoritesCount:0,compareCount:0},delimiters:["(#","#)"],methods:{request:function(t,e,r){var o=this;this.loading.cart=!0,this.$shop.http("cart",t,e).then((function(i){1!=i[0]&&alert("Ошибка: корзина не загружена."),o.cart=i.cart,r&&r(),o.loading.cart=!1,o.status=o.cart.qty?"default":"empty";var n=new CustomEvent("shop-cart-"+t,{detail:{data:e,response:i}});document.dispatchEvent(n)}))},remove:function(t){confirm("Удалить товар из корзины?")&&this.request("remove",{index:t})},qty:function(t,e){var r=+this.cart.items[t].qty+e;r&&(this.cart.items[t].qty=r,this.request("qty",{index:t,qty:r}))},indexById:function(t){return this.cart.items.findIndex((function(e){return e.id==t}))},sendForm:function(){var t=this;this.loading.form=!0,this.formError="",this.$shop.http("order","sendForm",this.form).then((function(e){e[0]?(t.status="success",t.cart={items:{},qty:0},t.form.comment=t.form.message="",t.lastOrder=e[1]):t.error=e||"Ошибка",t.loading.form=!1;var r=new CustomEvent("shop-cart-order",{detail:{order:t.lastOrder}});document.dispatchEvent(r)}))}},computed:{plural:function(){var t=this.cart.qty;return["товар","товара","товаров"][t%100>4&&t%100<20?2:[2,0,1,1,1,2][t%10<5?t%10:5]]},cartClasses:function(){return[{"is-loaded":"loading"!=this.status},{"is-loading":this.loading.cart},{"is-empty":!this.cart.qty},{"not-empty":!!this.cart.qty}]}}},n=new Vue({mixins:[i],created:function(){var t=this;if(localStorage.getItem("shop_order_form"))try{this.form=JSON.parse(localStorage.getItem("shop_order_form"))}catch(t){localStorage.removeItem("shop_order_form")}this.$shop.$on("load",(function(e){if(t.cart=e.cart,t.methods=e.methods,t.status=t.cart.qty?"default":"empty",t.loading.cart=!1,e.user)for(var o in e.user)e.user[o]&&"object"!==r(e.user[o])&&(t.form[o]=e.user[o])})),this.favoritesCount=s("favorites").length,this.compareCount=s("compare").length},watch:{form:{handler:function(){var t=Object.assign({},this.form);t.delivery&&delete t.delivery,t.payment&&delete t.payment,localStorage.setItem("shop_order_form",JSON.stringify(t))},deep:!0}}});function s(t){var e=Cookies.get("shop_"+t)||{};try{e=JSON.parse(e)}catch(t){e=[]}return Array.isArray(e)||(e=[]),e}window.ShopCartApp=n,o.forEach((function(t){new Vue({el:t,mixins:[i]})})),document.addEventListener("submit",(function(t){if(t.target.matches(".shop-item form")){t.preventDefault();var e=t.target,r=e.querySelector(".shop-item-button"),o=e.querySelector("[name=qty]"),i=+e.querySelector("[name=id]").value,s=o?+o.value:1,a=e.querySelectorAll("[name^=opt-]")||[],c={};if(a.forEach((function(t){t.value&&(c[t.name]=t.value)})),e.classList.remove("is-error"),Object.values(c).length!==a.length)return e.classList.add("is-error"),void console.log("не выбраны опции");r&&r.classList.add("is-loading"),n.request("add",{id:i,qty:s,options:c},(function(){r&&r.classList.remove("is-loading"),r&&r.classList.add("is-added"),e.classList.add("is-added"),o&&(o.value=1)}))}}),!1),document.addEventListener("click",(function(t){var e=t.target.closest(".shop-item-plus, .shop-item-minus");if(e){t.preventDefault();var r=t.target.closest(".shop-item").querySelector("[name=qty]"),o=e.classList.contains("shop-item-minus")?-1:1,i=(parseInt(r.value)||0)+o;r.value=i>0?i:1;var n=new Event("change");r.dispatchEvent(n)}})),document.addEventListener("blur",(function(t){t.target.matches(".shop-item [name=qty]")&&(parseInt(t.target.value)||(t.target.value=1))}),!0),document.addEventListener("click",(function(t){var e=t.target.closest(".shop-item-to-favorites");if(e){t.preventDefault();var r="favorites",o=t.target.closest(".shop-item"),i=o.querySelector("[name=id]").value,a=document.querySelector(".shop-catalog-data"),c=a?a.dataset.pageType:"",l=s(r),u=l.indexOf(i);u>-1?(l.splice(u,1),e.classList.remove("is-active"),c==r&&o.remove()):(l.push(i),e.classList.add("is-active")),n[r+"Count"]=l.length,Cookies.set("shop_"+r,l)}}))},21:function(t,e){var r=document.querySelectorAll(".shop-catalog-app")||[],o=document.querySelector(".shop-catalog-items"),i=document.querySelector(".shop-catalog-data"),n=document.querySelector("[data-shop-filters]"),s=new URLSearchParams(location.search.slice(1));if(r.length){var a={};n&&(a=n.dataset.shopFilters,a=JSON.parse(a));var c,l,u=a.filters||{},d=a.list||[],h={},f={};for(var p in d)h[d[p]]=[];s.forEach((function(t,e){e.includes("filter_")&&(t=t.split(","),f[e]=t,h[e.replace("filter_","")]=t),e.includes("min_")&&(f[e]=t,e=e.replace("min_",""),h[e]&&(h[e][0]=t)),e.includes("max_")&&(f[e]=t,e=e.replace("max_",""),h[e]&&(h[e][1]=t))})),o&&(c=i.dataset.total||0,l=i.dataset.limit||1);var m={total:c,limit:l,filters:u,filtersList:d,filterForm:Object.assign({},h),filterQuery:f,isFiltered:!!Object.entries(f).length,filterSection:"",filterVisible:!1,page:+s.get("page")||1,view:Cookies.get("shop_view")||"grid",sort:Cookies.get("shop_sort")||"pagetitle"},v={request:function(t){var e=this;this.isFiltered=!!Object.entries(this.filterQuery).length,o.classList.add("is-loading"),t&&(this.page=1);var r={filter:Object.assign({},this.filterQuery)};this.page>1&&(r.filter.page=this.page),s.get("search")?s.get("search")&&(r.filter.search=s.get("search")):r.filter.sort=this.sort;var i=new URLSearchParams(r.filter);history.pushState(null,null,window.location.pathname+"?"+i),this.$shop.http("catalogSnippet","renderCatalog",r).then((function(t){var r=document.createElement("div");r.innerHTML=t.html;var i=r.querySelector(".shop-catalog-items");o.innerHTML="",o.insertAdjacentHTML("beforeend",i.innerHTML),e.total=t.total,o.classList.remove("is-loading");var n=new CustomEvent("shop-catalog-update",{detail:{el:o}});document.dispatchEvent(n)}))},filter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"checkboxes";"range"==e?(this.filterQuery["min_"+t]=this.filterForm[t][0],this.filterQuery["max_"+t]=this.filterForm[t][1]):this.filterForm[t].length?this.filterQuery["filter_"+t]=this.filterForm[t]:delete this.filterQuery["filter_"+t],this.request(!0)},sorting:function(){this.request(!0),Cookies.set("shop_sort",this.sort)},pagination:function(t){this.request(),window.scrollTo({top:0,behavior:"smooth"}),this.filterVisible=!1},reset:function(){for(var t in this.filterForm)this.filterForm[t]=[];this.filterQuery={},this.request(!0),this.filterVisible=!1}};if(r.length)new Vue({data:m,methods:v,watch:{view:function(t){var e=o.classList;o.className.split(" ").forEach((function(t){return t.includes("has-view-")&&e.remove(t)})),e.add("has-view-".concat(t)),Cookies.set("shop_view",t)}}});r.forEach((function(t){new Vue({el:t,data:m,methods:v,delimiters:["(#","#)"]})}))}},22:function(t,e){var r=document.querySelector(".vue-shop-auth");r&&new Vue({el:r,delimiters:["(#","#)"],data:{user:{},isAuth:!1,login:{form:{},loading:!1,message:""},reg:{form:{},loading:!1,message:"",errors:{},success:!1}},methods:{authorize:function(){var t=this;this.login.loading=!0,this.login.message="",this.$shop.http("user","login",this.login.form).then((function(e){t.login.loading=!1,e[0]?location.reload():t.login.message=e.error||"Ошибка входа"}))},register:function(){var t=this;this.reg.loading=!0,this.reg.errors={},this.$shop.http("user","register",this.reg.form).then((function(e){t.reg.errors=e.errors||{},t.reg.loading=!1,t.reg.success=!!e[0]}))},logout:function(){this.$shop.http("user","logout").then((function(t){+t[0]?location.reload():alert(t.error||"Ошибка")}))}},created:function(){var t=this;this.$shop.$on("load",(function(e){e.user&&(t.user=e.user,t.isAuth=!!+e.user.id)}))}})},23:function(t,e){var r=document.querySelector(".vue-shop-cabinet"),o=window.location.hash.split("/");r&&new Vue({el:r,delimiters:["(#","#)"],data:{user:{},tab:o[1]||!1,orderId:o[2]||0,orders:[],profile:{errors:{},form:{},loading:!1,success:!1},password:{errors:{},form:{newpassword:1},loading:!1,success:!1}},methods:{update:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"profile";["profile","password"].includes(e)&&(this[e].loading=!0,this[e].success=!1,this[e].errors={},this.$shop.http("user","update",this[e].form).then((function(r){t[e].errors=r.errors||{},t[e].loading=!1,t[e].success=!!r[0],t[e].success&&"password"==e&&(t[e].specifiedpassword="",t[e].confirmpassword="")})))},cancelOrder:function(){var t=this;if(confirm("Отменить заказ?")){var e={id:this.order.id,status:"canceled",comment:"Отменён пользователем"};this.$shop.http("order","changeStatus",e).then((function(e){t.$shop.http("order","getMyOrders").then((function(e){t.orders=e.rows||[]}))}))}}},computed:{order:function(){var t=this;return+this.orderId&&this.orders.length?(window.location.hash="/orders/".concat(this.orderId),this.orders.find((function(e){return e.id==t.orderId}))||{}):{}}},created:function(){var t=this;this.$shop.$on("load",(function(e){e.user&&(t.user=e.user,t.profile.form=e.user)})),this.$shop.http("order","getMyOrders").then((function(e){t.orders=e.rows||[]})),window.onhashchange=function(){o=window.location.hash.split("/"),t.tab=o[1]||"orders","orders"==o[1]&&+o[2]?t.orderId=+o[2]:t.orderId=0},this.tab||(this.tab="orders",window.location.hash="/orders")}})},25:function(t,e,r){"use strict";r.r(e);var o=r(8),i=r.n(o),n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"wrapper",staticClass:"search",class:{"is-loading":t.loading,"is-expanded":t.show}},[r("div",{staticClass:"search-field field"},[r("input",t._b({directives:[{name:"model",rawName:"v-model.trim",value:t.value,expression:"value",modifiers:{trim:!0}}],staticClass:"search-input input",attrs:{type:"search",autocomplete:"off"},domProps:{value:t.value},on:{focus:function(e){return t.focus()},input:function(e){e.target.composing||(t.value=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}},"input",t.$attrs,!1)),t._v(" "),r("div",{staticClass:"field-icon"})]),t._v(" "),t.show?r("div",{staticClass:"search-lists"},[t.products.length?[r("div",{staticClass:"search-list-title"},[t._v("Товары")]),t._v(" "),r("ul",{staticClass:"search-list"},t._l(t.products,(function(e){return r("li",{staticClass:"search-item"},[r("a",{staticClass:"search-item-link",attrs:{href:e.uri}},[t._v("\n\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t")])])})),0)]:t._e(),t._v(" "),t.categories.length?[r("div",{staticClass:"search-list-title"},[t._v("Категории")]),t._v(" "),r("ul",{staticClass:"search-list"},t._l(t.categories,(function(e){return r("li",{staticClass:"search-item"},[r("a",{staticClass:"search-item-link",attrs:{href:e.uri}},[t._v("\n\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t")])])})),0)]:t._e(),t._v(" "),t.nothing?r("div",{staticClass:"search-empty"},[t._v("Ничего не найдено")]):t._e()],2):t._e()])};n._withStripped=!0;var s=new URLSearchParams(location.search.slice(1)),a={data:function(){return{products:[],categories:[],value:s.get("search")||"",show:!1,timer:null,loading:!1,nothing:!1,typed:!1}},inheritAttrs:!1,props:{},methods:{focus:function(){this.show=!!(this.value.length>2&&this.typed)},request:function(t){var e=this;this.$shop.http("catalog","liveSearch",{query:t}).then((function(t){var r=t.rows||[];e.show=!0,e.nothing=!r.length,e.loading=!1,e.products=r.filter((function(t){return"product"==t.type})),e.categories=r.filter((function(t){return"category"==t.type}))}))},documentClick:function(t){var e=this.$refs.wrapper,r=t.target;e===r||e.contains(r)||(this.show=!1)}},watch:{value:function(t){this.typed=!0,!t||t.length<=2?this.show=!1:(this.loading=!0,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.request,500,t))}},created:function(){document.addEventListener("click",this.documentClick)},destroyed:function(){document.removeEventListener("click",this.documentClick)}},c=r(0),l=Object(c.a)(a,n,[],!1,null,null,null);l.options.__file="src/frontend/components/live-search.vue";var u=l.exports;function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}window.Cookies=i.a,window.Shop=window.Shop||{},Vue.mixin({filters:{numFormat:function(t){return t?(t=parseFloat(t).toFixed(0),t=String(t).replace(/(\d)(?=(\d{3})+([^\d]|$))/g,"$1 ")):0}}}),Vue.prototype.$shop=new Vue({data:{url:"/assets/components/effectshop/connector.php",resource:window.resource||{},delimiters:["(#","#)"],pathname:window.location.pathname},methods:{toFormData:function(t,e,r){var o,i=e||new FormData;for(var n in t)t.hasOwnProperty(n)&&t[n]&&(o=r?r+"["+n+"]":n,"object"!==d(t[n])||t[n]instanceof File?i.append(o,t[n]):this.toFormData(t[n],i,o));return i},http:function(t,e){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.toFormData(o);return i.append("ctx",this.resource.ctx||"web"),new Promise((function(o,n){fetch(r.url+"?to=".concat(t,"&action=").concat(e),{method:"post",body:i}).then((function(t){return t.json()})).then((function(t){o(t)})).catch((function(t){console.log("Ошибка: ".concat(t)),alert("Ошибка: ".concat(t))}))}))}},created:function(){var t=this;this.http("shop","load").then((function(e){1==e[0]?t.$emit("load",e):alert("Ошибка загрузки корзины")}))}}),(document.querySelectorAll(".vue-shop-livesearch")||[]).forEach((function(t){new Vue({el:t,data:{},components:{ShopLiveSearch:u},delimiters:["(#","#)"]})}));r(20),r(21),r(22),r(23)},8:function(t,e,r){var o,i;
/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */!function(n){if(void 0===(i="function"==typeof(o=n)?o.call(e,r,e,t):o)||(t.exports=i),!0,t.exports=n(),!!0){var s=window.Cookies,a=window.Cookies=n();a.noConflict=function(){return window.Cookies=s,a}}}((function(){function t(){for(var t=0,e={};t<arguments.length;t++){var r=arguments[t];for(var o in r)e[o]=r[o]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(o){function i(){}function n(e,r,n){if("undefined"!=typeof document){"number"==typeof(n=t({path:"/"},i.defaults,n)).expires&&(n.expires=new Date(1*new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var s=JSON.stringify(r);/^[\{\[]/.test(s)&&(r=s)}catch(t){}r=o.write?o.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in n)n[c]&&(a+="; "+c,!0!==n[c]&&(a+="="+n[c].split(";")[0]));return document.cookie=e+"="+r+a}}function s(t,r){if("undefined"!=typeof document){for(var i={},n=document.cookie?document.cookie.split("; "):[],s=0;s<n.length;s++){var a=n[s].split("="),c=a.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=e(a[0]);if(c=(o.read||o)(c,l)||e(c),r)try{c=JSON.parse(c)}catch(t){}if(i[l]=c,t===l)break}catch(t){}}return t?i[t]:i}}return i.set=n,i.get=function(t){return s(t,!1)},i.getJSON=function(t){return s(t,!0)},i.remove=function(e,r){n(e,"",t(r,{expires:-1}))},i.defaults={},i.withConverter=r,i}((function(){}))}))}});