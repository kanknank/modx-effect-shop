!function(t){var e={};function r(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=4)}([function(t,e,r){var o,n;
/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */!function(i){if(void 0===(n="function"==typeof(o=i)?o.call(e,r,e,t):o)||(t.exports=n),!0,t.exports=i(),!!0){var a=window.Cookies,s=window.Cookies=i();s.noConflict=function(){return window.Cookies=a,s}}}((function(){function t(){for(var t=0,e={};t<arguments.length;t++){var r=arguments[t];for(var o in r)e[o]=r[o]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(o){function n(){}function i(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=t({path:"/"},n.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var a=JSON.stringify(r);/^[\{\[]/.test(a)&&(r=a)}catch(t){}r=o.write?o.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in i)i[c]&&(s+="; "+c,!0!==i[c]&&(s+="="+i[c].split(";")[0]));return document.cookie=e+"="+r+s}}function a(t,r){if("undefined"!=typeof document){for(var n={},i=document.cookie?document.cookie.split("; "):[],a=0;a<i.length;a++){var s=i[a].split("="),c=s.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=e(s[0]);if(c=(o.read||o)(c,l)||e(c),r)try{c=JSON.parse(c)}catch(t){}if(n[l]=c,t===l)break}catch(t){}}return t?n[t]:n}}return n.set=i,n.get=function(t){return a(t,!1)},n.getJSON=function(t){return a(t,!0)},n.remove=function(e,r){i(e,"",t(r,{expires:-1}))},n.defaults={},n.withConverter=r,n}((function(){}))}))},function(t,e){var r=document.querySelectorAll(".shop-catalog-app, .vue-shop-catalog")||[],o=document.querySelector(".shop-catalog-items"),n=document.querySelector(".shop-catalog-data"),i=document.querySelector("[data-shop-filters]"),a=new URLSearchParams(location.search.slice(1));if(r.length){var s={};i&&(s=i.dataset.shopFilters,s=JSON.parse(s));var c,l,u=s.filters||{},d=s.list||[],h={},f={};for(var p in d)h[d[p]]=[];a.forEach((function(t,e){e.includes("filter_")&&(t=t.split(","),f[e]=t,h[e.replace("filter_","")]=t),e.includes("min_")&&(f[e]=t,e=e.replace("min_",""),h[e]&&(h[e][0]=t)),e.includes("max_")&&(f[e]=t,e=e.replace("max_",""),h[e]&&(h[e][1]=t))})),o&&(c=n.dataset.total||0,l=n.dataset.limit||1);var m={total:c,limit:l,filters:u,filtersList:d,filterForm:Object.assign({},h),filterQuery:f,isFiltered:!!Object.entries(f).length,filterSection:"",filterVisible:!1,page:+a.get("page")||1,view:Cookies.get("shop_view")||"grid",sort:Cookies.get("shop_sort")||""},v={request:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isFiltered=!!Object.entries(this.filterQuery).length,o.classList.add("is-loading"),t&&(this.page=1);var n={filter:Object.assign({},this.filterQuery)};this.page>1&&(n.filter.page=this.page),a.get("search")?a.get("search")&&(n.filter.search=a.get("search")):n.filter.sort=this.sort;var i=new URLSearchParams(n.filter);history.pushState(null,null,window.location.pathname+"?"+i),this.$shop.http("catalogSnippet","renderCatalog",n).then((function(t){var n=document.createElement("div");n.innerHTML=t.html;var i=n.querySelector(".shop-catalog-items");r||(o.innerHTML=""),o.insertAdjacentHTML("beforeend",i.innerHTML),e.total=t.total,o.classList.remove("is-loading");var a=new CustomEvent("shop-catalog-update",{detail:{el:o}});document.dispatchEvent(a)}))},filter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"checkboxes";"range"==e?(this.filterQuery["min_"+t]=this.filterForm[t][0],this.filterQuery["max_"+t]=this.filterForm[t][1]):this.filterForm[t].length?this.filterQuery["filter_"+t]=this.filterForm[t]:delete this.filterQuery["filter_"+t],this.request(!0)},sorting:function(){this.request(!0),Cookies.set("shop_sort",this.sort)},pagination:function(t){this.request(),window.scrollTo({top:0,behavior:"smooth"}),this.filterVisible=!1},showMore:function(){this.page>=this.pages||(this.page++,this.request(!1,!0))},reset:function(){for(var t in this.filterForm)this.filterForm[t]=[];this.filterQuery={},this.request(!0),this.filterVisible=!1}},y={pages:function(){return Math.ceil(this.total/this.limit)}};if(r.length)new Vue({data:m,methods:v,watch:{view:function(t){var e=o.classList;o.className.split(" ").forEach((function(t){return t.includes("has-view-")&&e.remove(t)})),e.add("has-view-".concat(t)),Cookies.set("shop_view",t)}}});r.forEach((function(t){new Vue({el:t,data:m,methods:v,computed:y,delimiters:["(#","#)"]})}))}},function(t,e){var r=document.querySelector(".vue-shop-cabinet"),o=window.location.hash.split("/");r&&new Vue({el:r,delimiters:["(#","#)"],data:{user:{},tab:o[1]||!1,orderId:o[2]||0,orders:[]},methods:{cancelOrder:function(){var t=this;if(confirm("Отменить заказ?")){var e={id:this.order.id,status:"canceled",comment:"Отменён пользователем"};this.$shop.http("order","changeStatus",e).then((function(e){t.$shop.http("order","getMyOrders").then((function(e){t.orders=e.rows||[]}))}))}}},computed:{order:function(){var t=this;return+this.orderId&&this.orders.length?(window.location.hash="/orders/".concat(this.orderId),this.orders.find((function(e){return e.id==t.orderId}))||{}):{}}},created:function(){var t=this;this.$shop.http("order","getMyOrders").then((function(e){t.orders=e.rows||[]})),window.onhashchange=function(){o=window.location.hash.split("/"),t.tab=o[1]||"orders","orders"==o[1]&&+o[2]?t.orderId=+o[2]:t.orderId=0},this.tab||(this.tab="orders",window.location.hash="/orders")}})},function(t,e){var r=document.querySelectorAll(".vue-shop-livesearch")||[],o=new URLSearchParams(location.search.slice(1));r.forEach((function(t){new Vue({el:t,delimiters:["(#","#)"],data:function(){return{products:[],categories:[],value:o.get("search")||"",show:!1,timer:null,loading:!1,nothing:!1,typed:!1}},methods:{focus:function(){this.show=!!(this.value.length>2&&this.typed)},request:function(t){var e=this;this.$shop.http("catalog","liveSearch",{query:encodeURIComponent(t)}).then((function(t){var r=t.rows||[];e.show=!0,e.nothing=!r.length,e.loading=!1,e.products=r.filter((function(t){return"product"==t.type})),e.categories=r.filter((function(t){return"category"==t.type}))}))},documentClick:function(t){var e=this.$refs.wrapper,r=t.target;e===r||e.contains(r)||(this.show=!1)}},watch:{value:function(t){this.typed=!0,!t||t.length<=2?this.show=!1:(this.loading=!0,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.request,500,t))}},created:function(){document.addEventListener("click",this.documentClick)},destroyed:function(){document.removeEventListener("click",this.documentClick)}})}))},function(t,e,r){"use strict";r.r(e);var o=r(0),n=r.n(o);function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}window.Cookies=n.a,window.Shop=window.Shop||{},Vue.mixin({filters:{numFormat:function(t){return t?t=(t=(t=Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(t)).replace(",00","")).replace(" ₽",""):0}}}),Vue.prototype.$shop=new Vue({data:{url:"/assets/components/effectshop/connector.php",delimiters:["(#","#)"],pathname:window.location.pathname},methods:{toFormData:function(t,e,r){var o,n=e||new FormData;for(var a in t)t.hasOwnProperty(a)&&"undefined"!==t[a]&&(o=r?r+"["+a+"]":a,Array.isArray(t[a])&&!t[a].length&&n.append(o,t[a]),"object"!==i(t[a])||t[a]instanceof File?n.append(o,t[a]):this.toFormData(t[a],n,o));return n},http:function(t,e){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.toFormData(o);return new Promise((function(o,i){fetch(r.url+"?to=".concat(t,"&action=").concat(e),{method:"post",body:n}).then((function(t){return t.json()})).then((function(t){o(t)})).catch((function(t){console.log("Ошибка: ".concat(t))}))}))}}});var a={data:{status:"loading",cart:{qty:0,items:{}},methods:{},form:{},lastOrder:{},loading:{cart:!0,form:!1},error:"",favoritesCount:0,compareCount:0},delimiters:["(#","#)"],methods:{request:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;this.loading.cart=!0,this.$shop.http("cart",t,r).then((function(n){1!=n[0]&&alert("Ошибка: корзина не загружена."),e.cart=n.cart,o&&o(),e.loading.cart=!1,e.status=e.cart.qty?"default":"empty";var i=new CustomEvent("shop-cart-request",{detail:{action:t,data:r,response:n}});document.dispatchEvent(i)}))},remove:function(t){confirm("Удалить товар из корзины?")&&this.request("remove",{index:t})},qty:function(t,e){var r=+this.cart.items[t].qty+e;r<0||(0!==r?(this.cart.items[t].qty=r,this.request("qty",{index:t,qty:r})):this.remove(t))},setValue:function(t,e){this.request("setValue",{key:t,val:e})},addonQty:function(t,e,r){var o=this.cart.items[t].addons[e],n=+o.qty+r;n<0||(o.qty=n,this.request("addonQty",{index:t,addon:e,qty:n}))},clean:function(){confirm("Очистить корзину?")&&this.request("clean")},indexById:function(t){var e=-1;return this.cart.items&&(e=this.cart.items.findIndex((function(e){return e.id==t}))),e},sendForm:function(){var t=this;this.loading.form=!0,this.formError="",this.$shop.http("order","sendForm",this.form).then((function(e){if(e[0]){t.status="success",t.cart={items:{},qty:0},t.form.comment=t.form.message="",t.lastOrder=e[1],window.scrollTo({top:0});var r=new CustomEvent("shop-cart-order",{detail:{order:t.lastOrder}});document.dispatchEvent(r)}else t.error=e||"Ошибка";t.loading.form=!1}))},getProductForm:function(t){var e={},r="FORM"==t.tagName?t:t.closest("form");return!!r&&(e.form=r,e.button=r.querySelector(".shop-item-button"),e.id_el=r.querySelector("[name=id]"),e.qty_el=r.querySelector("[name=qty]"),e.opt_els=r.querySelectorAll("[name^=opt-]")||[],e.addon_qty_els=r.querySelectorAll("[name^=addon-qty-]"),e.addon_els=r.querySelectorAll("[name=addon]"),e.prices_plus_els=r.querySelectorAll("[data-price-plus]"),e.variation_el=r.querySelector("[name=variation]:checked"),e.price_el=r.querySelector("[data-price]"),e.id=+e.id_el.value,e.qty=e.qty_el?+e.qty_el.value:1,e.params={opts:{},addons:{}},e.variation_el&&(e.params.variation=e.variation_el.value||0),e.addon_els.forEach((function(t){isNaN(parseInt(t.value))||t.type&&["checkbox","radio"].includes(t.type)&&t.checked&&(e.params.addons[+t.value]=1)})),e.addon_qty_els.forEach((function(t){var r=t.name.split("-");e.params.addons[r[2]]=+t.value})),e.opt_els.forEach((function(t){t.value&&(e.params.opts[t.name]=t.value)})),e)}},computed:{plural:function(){var t=this.cart.qty;return["товар","товара","товаров"][t%100>4&&t%100<20?2:[2,0,1,1,1,2][t%10<5?t%10:5]]},cartClasses:function(){return[{"is-loaded":"loading"!=this.status},{"is-loading":this.loading.cart},{"is-empty":!this.cart.qty},{"not-empty":!!this.cart.qty}]}}};function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var c=document.querySelectorAll(".vue-shop-cart");if(c.length){var l=new Vue({mixins:[a],created:function(){var t=this;if(localStorage.getItem("shop_order_form"))try{this.form=JSON.parse(localStorage.getItem("shop_order_form"))}catch(t){localStorage.removeItem("shop_order_form")}this.$shop.http("shop","load").then((function(e){if(e[0]||alert("Ошибка загрузки корзины"),t.cart=e.cart,t.methods=e.methods,t.status=t.cart.qty?"default":"empty",t.loading.cart=!1,e.user)for(var r in e.user)e.user[r]&&"object"!==s(e.user[r])&&(t.form[r]=e.user[r]);var o=new CustomEvent("shop-cart-load",{detail:{response:e}});document.dispatchEvent(o)})),this.favoritesCount=u("favorites").length,this.compareCount=u("compare").length},watch:{form:{handler:function(){var t=Object.assign({},this.form);t.delivery&&delete t.delivery,t.payment&&delete t.payment,localStorage.setItem("shop_order_form",JSON.stringify(t))},deep:!0}}});window.ShopCartApp=l}function u(t){var e=Cookies.get("shop_"+t)||{};try{e=JSON.parse(e)}catch(t){e=[]}return Array.isArray(e)||(e=[]),e}c.forEach((function(t){new Vue({el:t,mixins:[a]})})),document.addEventListener("submit",(function(t){if(t.target.matches(".shop-item form")){t.preventDefault();var e=ShopCartApp.getProductForm(t.target);e.button&&e.button.classList.add("is-loading"),ShopCartApp.request("add",{id:e.id,qty:e.qty,params:e.params},(function(){e.button&&e.button.classList.remove("is-loading"),e.button&&e.button.classList.add("is-added"),e.form.classList.add("is-added")}))}}),!1),document.addEventListener("change",(function(t){if(t.target.closest(".shop-item form")){var e=ShopCartApp.getProductForm(t.target);if(e.price_el){var r,o=+e.price_el.dataset.price.replace(",",".");if(e.variation_el){var n=+e.variation_el.dataset.variationPrice.replace(",",".")||0;n&&(o=n)}e.addon_qty_els&&e.addon_qty_els.forEach((function(t){t.dataset.addonPrice&&(o+=+t.value*+t.dataset.addonPrice.replace(",","."))})),e.prices_plus_els&&e.prices_plus_els.forEach((function(t){t.type&&["checkbox","radio"].includes(t.type)&&t.checked&&(o+=+t.dataset.pricePlus.replace(",","."))})),o*=e.qty,e.price_el.innerHTML=(r=o)?r=(r=(r=Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(r)).replace(",00","")).replace(" ₽",""):0}}}),!0),document.addEventListener("click",(function(t){var e=t.target.closest(".shop-item-plus, .shop-item-minus");if(e){t.preventDefault();var r=t.target.parentNode.querySelector("[name*=qty]"),o=e.classList.contains("shop-item-minus")?-1:1,n=(parseInt(r.value)||0)+o,i=r.hasAttribute("min")?+r.min:1;n<(r.hasAttribute("max")?+r.max:999)+1&&n>i-1&&(r.value=n,r.dispatchEvent(new Event("change")))}})),document.addEventListener("blur",(function(t){if(t.target.matches(".shop-item [name*=qty]")){var e=t.target.hasAttribute("min")?+t.target.min:1,r=t.target.hasAttribute("max")?+t.target.max:999;parseInt(t.target.value)||(t.target.value=e),t.target.value>r&&(t.target.value=r),t.target.value<e&&(t.target.value=e),t.target.dispatchEvent(new Event("change"))}}),!0),document.addEventListener("click",(function(t){var e=t.target.closest(".shop-item-to-favorites");if(e){t.preventDefault();var r="favorites",o=t.target.closest(".shop-item"),n=o.querySelector("[name=id]").value,i=document.querySelector(".shop-catalog-data"),a=i?i.dataset.pageType:"",s=u(r),c=s.indexOf(n);c>-1?(s.splice(c,1),e.classList.remove("is-active"),a==r&&o.remove()):(s.push(n),e.classList.add("is-active")),ShopCartApp[r+"Count"]=s.length,Cookies.set("shop_"+r,s)}}));r(1),r(2),r(3)}]);